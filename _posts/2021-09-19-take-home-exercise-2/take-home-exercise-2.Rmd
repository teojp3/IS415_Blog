---
title: "Take Home Exercise 2"
description: |
  A study on the distribution of Airbnb Listings in Singapore, and how has COVID-19 impacted them.
author:
  - name: Teo Jun Peng
    url: https://teojp3-is415.netlify.app/
date: 09-19-2021
output:
  distill::distill_article:
      self_contained: false
      toc: true
      toc_depth: 2
      toc_float: true
---

```{r setup, include=FALSE, eval=TRUE, echo=TRUE, message=FALSE, error=FALSE, fig.retina=3}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introduction

Singapore is one of the few countries that does not legalise short-term rentals for properties, a minimum stay of three months is still required for rental of properties as of [2019](https://www.todayonline.com/singapore/short-term-home-sharing-remains-illegal-singapore-airbnb-disappointed). Therefore, it was surprising to discover data sets for Airbnb listings located in Singapore in [Inside Airbnb]('http://insideairbnb.com/about.html'). But we shall dive deeper into this phenomenon of Airbnb being allowed in Singapore perhaps another day. 

For this exercise, we will utilising those data sets to generate useful insights through:

- Analysing the distribution of Airbnb listings in Pre-COVID Singapore using 2019 dataset
- Analysing the impact of COVID-19 on these listings based on the most updated 2021 dataset

## 1.1 The Data

For analysis purposes, the following data are used:

- Airbnb listings for June 2019 and June 2021 from [Inside Airbnb]('http://insideairbnb.com/get-the-data.html')

- Various geospatial data sets of choice extracted from SLA OneMap Service, using [OneMap.Sg API]('https://cran.r-project.org/web/packages/onemapsgapi/index.html')

# 2. Setting up the environment

To begin the study, R packages will be used for efficiency and a more comprehensive analysis, such as *tidyverse* and *sf* etc.

```{r results='hide'}

packages <- c('readr','maptools', 'sf', 'raster', 'spatstat', 'tmap', 'tidyverse', 'plotly', 'ggthemes')
for (p in packages)
  {
  if(!require(p, character.only = T))
    {
    install.packages(p)
  }
  library(p,character.only = T)
}
```

# 3. Data Wrangling

## 3.1 Aspatial Data

### 3.1.1 Importing in Aspatial Data 

We will first import in data using the Airbnb 2019 dataset, to see the distribution of listings. The analysis aims to uncover whether the distribution of Airbnb listings are affected by location factors such as near hotels or tourist attractions. 

Kernel Density Maps will be used to unravel spatial patterns between the location of listings and various location factors mentioned earlier on. The advantage of using Kernel Density over Point Density is that the results are much more spatially accurate, because Point Density usually produces more steep edges which is not desirable. On the other hand, Kernel density gives smoother results that allows for plotting nicer visuals, which is crucial for getting substantial analysis insights. 

![Visual comparison of Point Density vs Kernel Density](DensityPoint.png)

```{r results='hide'}
airbnb_2019 <- read_csv("data/the2data/airbnb2019.csv")
airbnb_2021 <- read_csv("data/the2data/airbnb2021.csv")
sg_hotels <- read_csv("data/the2data/OneMapData/hotels.csv") 
tourist_attractions <- read_csv("data/the2data/OneMapData/tourism.csv")
```

## Recalibrating Projected Coordinates Systems to the correct one

The coordinates in the respective data frames were defined in values of Latitude and Longitude, therefore being congruent with **EPSG 4326**. However, Singapore's national Project Coordination Systems should be **EPSG 3414 (SVY21)** instead, therefore we will transform the *crs* to the correct one.

```{r}
airbnb_2019 <- st_as_sf(airbnb_2019,
                    coords = c("longitude",
                               "latitude"),
                    crs = 4326) %>%
  st_transform(crs = 3414)

airbnb_2021 <- st_as_sf(airbnb_2021,
                    coords = c("longitude",
                               "latitude"),
                    crs = 4326) %>%
  st_transform(crs = 3414)

sg_hotels <- st_as_sf(sg_hotels,
                    coords = c("Lng",
                               "Lat"),
                    crs = 4326) %>%
  st_transform(crs = 3414)
```

For tourist attractions, an extra step is needed because there are NA values, so we have to drop them. If not, we will get an error "missing values in coordinates not allowed".

```{r}
tourist_attractions <- tourist_attractions[!is.na(tourist_attractions$LATITUDE), ]
tourist_attractions <- st_as_sf(tourist_attractions,
                    coords = c("LONGTITUDE",
                               "LATITUDE"),
                    crs = 4326) %>%
  st_transform(crs = 3414)
```

Checking and ensuring Projected Coordinates Systems of the sf object is correct

```{r}
st_crs(airbnb_2019)
```

```{r}
tmap_mode("view")
tm_shape(airbnb_2019) +
  tm_dots(alpha = 0.4,
          col = "blue",
          size = 0.05) +
  tm_shape(sg_hotels) +
  tm_dots(alpha = 0.4,
          col = "red",
          size = 0.05) +
  tm_shape(tourist_attractions) +
  tm_dots(alpha = 0.4,
          col = "green",
          size = 0.05) 
```

```{r}
tmap_mode("view")
tm_shape(airbnb_2021) +
  tm_dots(alpha = 0.4,
          col = "blue",
          size = 0.05) 
```

# References

- [Short-term home sharing remains illegal in Singapore; Airbnb disappointed](https://www.todayonline.com/singapore/short-term-home-sharing-remains-illegal-singapore-airbnb-disappointed)

- [Kernel vs Point Density](https://community.esri.com/t5/arcgis-spatial-analyst-questions/kernel-vs-point-density/td-p/610486)









