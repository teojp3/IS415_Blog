---
title: "In-class Exercise 4"
description: |
  In this hands-on exercise, we learnt how to handle raster-based geospatial data and convert data to spatial/sp/ppp classes using sf package.
author:
  - name: Teo Jun Peng
    url: https://teojp3-is415.netlify.app/
date: 09-06-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Installing and Loading the R Packages

- sf is mainly used for importing geospatial data
- raster is for handling raster-based geospatial data

```{r}
packages = c('maptools', 'sf', 'raster','spatstat', 'tmap', 'tidyverse', 'onemapsgapi')
for (p in packages){
if(!require(p, character.only = T)){
install.packages(p)
}
library(p,character.only = T)
}
```
## Trying out OneMap API

```{r}
get_theme_status('eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjc5NTgsInVzZXJfaWQiOjc5NTgsImVtYWlsIjoianVucGVuZy50ZW8uMjAxOUBzbXUuZWR1LnNnIiwiZm9yZXZlciI6ZmFsc2UsImlzcyI6Imh0dHA6XC9cL29tMi5kZmUub25lbWFwLnNnXC9hcGlcL3YyXC91c2VyXC9zZXNzaW9uIiwiaWF0IjoxNjMwODk2MTY4LCJleHAiOjE2MzEzMjgxNjgsIm5iZiI6MTYzMDg5NjE2OCwianRpIjoiYzBlNmJmNTg2OTVhOWJkOWE5NDU2MzFmOWI5YWY4YTIifQ._PeYQI2jiLSphQI_r5dzfzGbSCSPnZBW19_gOoENlvM', "kindergartens")
```

```{r}
search_themes('eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjc5NTgsInVzZXJfaWQiOjc5NTgsImVtYWlsIjoianVucGVuZy50ZW8uMjAxOUBzbXUuZWR1LnNnIiwiZm9yZXZlciI6ZmFsc2UsImlzcyI6Imh0dHA6XC9cL29tMi5kZmUub25lbWFwLnNnXC9hcGlcL3YyXC91c2VyXC9zZXNzaW9uIiwiaWF0IjoxNjMwODk2MTY4LCJleHAiOjE2MzEzMjgxNjgsIm5iZiI6MTYzMDg5NjE2OCwianRpIjoiYzBlNmJmNTg2OTVhOWJkOWE5NDU2MzFmOWI5YWY4YTIifQ._PeYQI2jiLSphQI_r5dzfzGbSCSPnZBW19_gOoENlvM')
```

## Importing Geospatial Data

```{r}
sg_sf <- st_read(dsn = "data/handson4data", layer="CostalOutline")

mpsz_sf <- st_read(dsn = "data/handson4data", layer = "MP14_SUBZONE_WEB_PL")
```
## Importing Aspatial Data

```{r}
childcare <- read_rds("data/ice4data/rds/childcare.rds")
CHAS <- read_rds('data/ice4data/rds/CHAS.rds')
```

```{r}
CHAS_sf <- st_as_sf(CHAS,
                    coords = c("X_COORDINATE",
                               "Y_COORDINATE"), crs = 3414)
```

```{r}
childcare$lat <- as.numeric(childcare$Lat)
childcare$Lng <- as.numeric(childcare$Lng)

childcare_sf <- st_as_sf(childcare, coords = c("Lng",
                                               "Lat"),
                         crs = 4326) %>%
  st_transform(crs = 3414)

mpsz_sf3414 <- st_transform(mpsz_sf, 
                              crs = 3414)

sg_sf3414 <- st_transform(sg_sf, 
                              crs = 3414)
```

## Geospatial Data Wrangling

### Converting from sf to Spatial* Classes

```{r}
childcare <- as_Spatial(childcare_sf)
CHAS <- as_Spatial(CHAS_sf)
mpsz <- as_Spatial(mpsz_sf3414)
sg <- as_Spatial(sg_sf3414)
```

### Convering from Spatial* classes to sp format

```{r}
childcare_sp <- as(childcare, "SpatialPoints")
CHAS_sp <- as(CHAS, "SpatialPoints")
sg_sp <- as(sg, "SpatialPolygons")
```

### Converting from sp to spatstat ppp format

```{r}
childcare_ppp <- as(childcare_sp, "ppp")
CHAS_ppp <- as(CHAS_sp, "ppp")
```














